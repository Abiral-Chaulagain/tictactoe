<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE-edge">
  <meta name="viewport" content="width-device-width, intial-scale= 1.0">
  <title>TicTacToe</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="header-wrapper">
    <h1 class="header">TicTacToe</h1>
  </div>
  <div class="body-wrapper">
    <div class="body-content-wrapper">
      <div class="tictactoe-wrapper">
        <div class="tictactoe-row-wrapper" id="0">
          <div class="tictactoe-row">
            <div class="tictactoe-cell" id="0"></div>
            <div class="tictactoe-row-divider" id="0"></div>
            <div class="tictactoe-cell" id="1"></div>
            <div class="tictactoe-row-divider" id="1"></div>
            <div class="tictactoe-cell" id="2"></div>
            <div class="tictactoe-row-divider" id="2"></div>
            <div class="tictactoe-cell" id="3"></div>
            <div class="tictactoe-row-divider" id="3"></div>
            <div class="tictactoe-cell" id="4"></div>
            <div class="tictactoe-row-divider" id="4"></div>
            <div class="tictactoe-cell" id="5"></div>
          </div>
        </div>
        <div class="tictactoe-column-divider" id="0"></div>
        <div class="tictactoe-row-wrapper" id="1">
          <div class="tictactoe-row">
            <div class="tictactoe-cell" id="6"></div>
            <div class="tictactoe-row-divider" id="0"></div>
            <div class="tictactoe-cell" id="7"></div>
            <div class="tictactoe-row-divider" id="1"></div>
            <div class="tictactoe-cell" id="8"></div>
            <div class="tictactoe-row-divider" id="2"></div>
            <div class="tictactoe-cell" id="9"></div>
            <div class="tictactoe-row-divider" id="3"></div>
            <div class="tictactoe-cell" id="10"></div>
            <div class="tictactoe-row-divider" id="4"></div>
            <div class="tictactoe-cell" id="11"></div>
          </div>
        </div>
        <div class="tictactoe-column-divider" id="1"></div>
        <div class="tictactoe-row-wrapper" id="2">
          <div class="tictactoe-row">
            <div class="tictactoe-cell" id="12"></div>
            <div class="tictactoe-row-divider" id="0"></div>
            <div class="tictactoe-cell" id="13"></div>
            <div class="tictactoe-row-divider" id="1"></div>
            <div class="tictactoe-cell" id="14"></div>
            <div class="tictactoe-row-divider" id="2"></div>
            <div class="tictactoe-cell" id="15"></div>
            <div class="tictactoe-row-divider" id="3"></div>
            <div class="tictactoe-cell" id="16"></div>
            <div class="tictactoe-row-divider" id="4"></div>
            <div class="tictactoe-cell" id="17"></div>
          </div>
        </div>
        <div class="tictactoe-column-divider" id="2"></div>
        <div class="tictactoe-row-wrapper" id="3">
          <div class="tictactoe-row">
            <div class="tictactoe-cell" id="18"></div>
            <div class="tictactoe-row-divider" id="0"></div>
            <div class="tictactoe-cell" id="19"></div>
            <div class="tictactoe-row-divider" id="1"></div>
            <div class="tictactoe-cell" id="20"></div>
            <div class="tictactoe-row-divider" id="2"></div>
            <div class="tictactoe-cell" id="21"></div>
            <div class="tictactoe-row-divider" id="3"></div>
            <div class="tictactoe-cell" id="22"></div>
            <div class="tictactoe-row-divider" id="4"></div>
            <div class="tictactoe-cell" id="23"></div>
          </div>
        </div>
        <div class="tictactoe-column-divider" id="3"></div>
        <div class="tictactoe-row-wrapper" id="4">
          <div class="tictactoe-row">
            <div class="tictactoe-cell" id="24"></div>
            <div class="tictactoe-row-divider" id="0"></div>
            <div class="tictactoe-cell" id="25"></div>
            <div class="tictactoe-row-divider" id="1"></div>
            <div class="tictactoe-cell" id="26"></div>
            <div class="tictactoe-row-divider" id="2"></div>
            <div class="tictactoe-cell" id="27"></div>
            <div class="tictactoe-row-divider" id="3"></div>
            <div class="tictactoe-cell" id="28"></div>
            <div class="tictactoe-row-divider" id="4"></div>
            <div class="tictactoe-cell" id="29"></div>
          </div>
        </div>
        <div class="tictactoe-column-divider" id="4"></div>
        <div class="tictactoe-row-wrapper" id="5">
          <div class="tictactoe-row">
            <div class="tictactoe-cell" id="30"></div>
            <div class="tictactoe-row-divider" id="0"></div>
            <div class="tictactoe-cell" id="31"></div>
            <div class="tictactoe-row-divider" id="1"></div>
            <div class="tictactoe-cell" id="32"></div>
            <div class="tictactoe-row-divider" id="2"></div>
            <div class="tictactoe-cell" id="33"></div>
            <div class="tictactoe-row-divider" id="3"></div>
            <div class="tictactoe-cell" id="34"></div>
            <div class="tictactoe-row-divider" id="4"></div>
            <div class="tictactoe-cell" id="35"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="player-names-wrapper">
      <div class="player-wrapper-active" id=P1>
        <h2 class="player-name">Player 1</h2>
      </div>
      <div class="player-wrapper" id=P2>
        <h2 class="player-name">Player 2</h2>
      </div>
    </div>
    <div class="details-wrapper">
      <button class="reset">Reset</button>
    </div>
    <div class="popup-overlay"></div>
    <div class="popup" id="gameend">
      <p class="popup-msg" id="gameend"></p>
      <button class="popup-btn" id="gameend">Reset Game</button>
    </div>
    <div class="popup" id="slotfilled">
      <p>Slot is already occupied</p>
      <button class="popup-btn" id="slotfilled">OK</button>
    </div>
    <div class="popup" id="gridsize">
      <p>Select the size of the board</p>
      <button class="popup-size-btn" id="3">3</button>
      <button class="popup-size-btn" id="4">4</button>
      <button class="popup-size-btn" id="5">5</button>
      <button class="popup-size-btn" id="6">6</button>
    </div>
  </div>
  <!--- jquery cdn script-->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script>
    circle_icon = "icons/circle.png";
    cross_icon = "icons/cross.png";
    let grid = [];
    let temp = [];
    let gameend = false;
    var winner = "0";
    // p1 is false p2 is true. p1 starts
    var player = false;
    //empty spaces
    var count = 0;
    //size
    var size = 0;


    function req_symbol() {
      if (player == false)
        return "X";
      else
        return "O";
    }

    function check_winner() {

      horizontal = 1;
      vertical = 1;

      for (let i = 0; i < size; i++) {
        for (let j = 1; j < size; j++) {
          if (grid[0][i] == grid[j][i]) {
            if (grid[0][i] == "X" || grid[0][i] == "O")
              horizontal++;
          }
        }
        //if horizontal == size it is a win
        if (horizontal == size) {
          winner = grid[0][i];
          is_winner = true;
          gameend = true;
          return;
        }
        else
          horizontal = 1;
      }

      for (let i = 0; i < size; i++) {
        for (let j = 1; j < size; j++) {
          if (grid[i][0] == grid[i][j]) {
            if (grid[i][0] == "X" || grid[i][0] == "O")
              vertical++;
          }
        }
        //if vertical == size it is a win
        if (vertical == size) {
          winner = grid[i][0];
          is_winner = true;
          gameend = true;
          return;
        }
        else
          vertical = 1;
      }


      let down = 1;
      let up = 1;
      for (let i = size - 1; i > 0; i--) {
        if (grid[0][0] == grid[size - i][size - i])
          if (grid[0][0] == "X" || grid[0][0] == "O")
            down++;
      }

      for (let i = 1; i < size; i++) {
        if (grid[0][size - 1] == grid[i][size - (i + 1)])
          if (grid[0][size - 1] == "X" || grid[0][size - 1] == "O")
            up++;
      }

      if (down == size) {
        is_winner = true;
        gameend = true;
        winner = grid[0][0];
      }
      if (up == size) {
        is_winner = true;
        gameend = true;
        winner = grid[0][size - 1];
      }
    }

    function select_grid_cells() {
      grid = [];
      array_len = size;
      base_array = [];
      count = size*size;
      for (i = 0; i < size; i++) {
        base_array.push("0");
      }
      for (i = 0; i < size; i++) {
        grid.push(base_array);
      }
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          id = 6 * (i + 1) - (6 - j);
          $(".tictactoe-cell[id=" + id + "]").css("display", "flex");
        }
      }
      select_row_column_dividers();
    }

    function select_row_column_dividers() {
      //for column wrappers
      for (let i = 0; i < size; i++)
        $(".tictactoe-row-wrapper[id=" + i + "]").toggle(function () {
          //change css attribute to flex
          $(this).css("display", "flex")
        });
      for (i = 0; i < (size - 1); i++) {
        $(".tictactoe-column-divider[id=" + i + "]").toggle();
        $(".tictactoe-row-divider[id=" + i + "]").toggle();
      }
    }

    function on_click() {
      if (gameend == true)
        game_end();

      cell_id = $(this).attr("id");

      //y
      y = Math.floor(cell_id / 6);
      //x
      x = (cell_id % 6);
      if (x == 6)
        x = 0;

      symbol = req_symbol();
      symbol_added = false;

      //remove the hover class with the id(ig id doesnt matter?)
      $(".tictactoe-icon-hover[id=" + cell_id + "]").remove();

      //add into grid 
      //check if space is free 
      if (grid[x][y] == "0") {

        add_into_grid(symbol, cell_id);
        //add symbol into page 
        if (symbol == "X") {
          $(".tictactoe-cell[id=" + cell_id + "]").append("<img class= tictactoe-icon id = " + cell_id + " src=" + cross_icon + " />");
        }
        else if (symbol == "O") {
          $(".tictactoe-cell[id=" + cell_id + "]").append("<img class= tictactoe-icon id = " + cell_id + " src=" + circle_icon + " />");
        }
        symbol_added = !symbol_added;
        count--;
      }
      //add alert later
      else {
        showpopup_slotfilled();
        return;
      }
      check_winner();

      //check if all cells are filled
      check_gameend();

      if (gameend == true) {
        game_end();
      }
      //swap players after click
      if (symbol_added == true)
        swap_players();
    }

    function add_into_grid(symbol, cell_id) {
      //y
      y = Math.floor(cell_id / 6);
      //x
      x = (cell_id % 6);
      if (x == 6) {
        x = 0;
      }

      temp = Array.from(grid[x]);
      temp[y] = symbol;
      grid[x] = temp;
    }

    function check_gameend() {
      if (count == 0)
        gameend = true;
    }


    function swap_players() {
      $("#P1").toggleClass("player-wrapper-active player-wrapper");
      $("#P2").toggleClass("player-wrapper-active player-wrapper");

      player = !player;
    }

    function reset_game() {
      //reset grid to empty
      grid = [];
      //remove the icons
      $(".tictactoe-icon").remove();

      //remove cells and dividers
      $(".tictactoe-cell").css("display", "none");
      $(".tictactoe-row-wrapper").css("display", "none");
      $(".tictactoe-column-divider").css("display", "none");
      $(".tictactoe-row-divider").css("display", "none");

      //reset player-actives
      $("#P1").removeClass("player-wrapper").addClass("player-wrapper-active");
      $("#P2").removeClass("player-wrapper-active").addClass("player-wrapper");

      //reset variables 
      gameend = false;
      winner = "0";
      player = false;
      count = 0;

      //run popup for size selection
      showpopup_gridsize();
    }

    function game_end() {
      if (winner == "X" || winner == "O")
        showpopup_gameend(winner + " wins the game.");
      else if (count == 0)
        showpopup_gameend("It's a draw.");
    }

    function showpopup_gameend(message) {
      $(".popup-msg[id=gameend]").text(message);
      $(".popup-overlay").fadeIn();
      $(".popup[id=gameend]").fadeIn();
    }

    function showpopup_slotfilled() {
      $(".popup-overlay").fadeIn();
      $(".popup[id=slotfilled]").fadeIn();
    }

    function showpopup_gridsize() {
      $(".popup-overlay").fadeIn();
      $(".popup[id=gridsize]").fadeIn();
    }

    $(".popup-btn[id = gameend]").click(function () {
      $(".popup, .popup-overlay").fadeOut();
      reset_game();
    })

    $(".popup-btn[id = slotfilled]").click(function () {
      $(".popup, .popup-overlay").fadeOut();
    })

    $(".popup-size-btn").click(function () {
      size = $(this).attr("id");
      select_grid_cells();
      $(".popup, .popup-overlay").fadeOut();
    })

    $(".tictactoe-cell").on("click", on_click);

    $(".tictactoe-cell").on("mouseenter", function () {

      //hoverin
      cell_id = $(this).attr("id");
      //y
      y = Math.floor(cell_id / 6);
      //x
      x = (cell_id % 6);
      if (x == 6) {
        x = 0;
      }
      if (grid[x][y] == "0") {
        a = req_symbol();
        if (a == "X") {
          $(".tictactoe-cell[id=" + cell_id + "]").append("<img class= tictactoe-icon-hover id = " + cell_id + " src=" + cross_icon + " />");
        }
        else if (a == "O") {
          $(".tictactoe-cell[id=" + cell_id + "]").append("<img class= tictactoe-icon-hover id = " + cell_id + " src=" + circle_icon + " />");
        }

      }

    }).on("mouseleave", function () {
      //hoverout
      cell_id = $(this).attr("id");
      //remove the hover class with the id(ig id doesnt matter?)
      $(".tictactoe-icon-hover[id=" + cell_id + "]").remove();

    })

    $(".reset").on("click", function () {
      reset_game();
    })


    $(function () {
      console.log("ready");
      showpopup_gridsize();
    });

  </script>
</body>

</html>